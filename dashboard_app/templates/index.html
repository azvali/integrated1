<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../static/css/style.css" />
    <title>Flask App</title>
  </head>
  <body>
    <div class="header_block">
      <div class="logo_block">
        <img
          src="../static/images/oakland_logo.png"
          alt="oakland university grizzly logo"
        />
        <div class="title_block">Oakland University Parking Watch</div>
      </div>
    </div>
    <div class="body_block">
      <div class="display_block">
        <div class="img_block">
          <img id="parking_lot_1" src="data:image/webp;base64,{{ base64_image }}" alt="Parking lot image" />
        </div>
        <div class="info_block">
          <div id="availability_1" class="availability_block">
            parking availability: {{ description }}
          </div>
          <div class="electric_block">electric car charging spots (yes/no)</div>
        </div>
      </div>
      <div class="display_block">
        <div class="img_block"></div>
        <div class="info_block">
          <div class="availability_block">
            parking availability (low, medium, high)
          </div>
          <div class="electric_block">electric car charging spots (yes/no)</div>
        </div>
      </div>
    </div>
    <div class="footer"></div>
    
    <!-- Add JavaScript for asynchronous updates -->
    <script>
      // Function to fetch the updated image and description asynchronously
      async function fetchParkingData() {
        try {
          const response = await fetch('/submit', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              description: 'fetch_latest',
              image: 'fetch_latest',
            }),
          });

          const data = await response.json();

          if (data.status === 'success') {
            // Update the image src with the new base64-encoded image
            document.getElementById('parking_lot_1').src =
              "data:image/webp;base64," + data.image;
            document.getElementById('availability_1').textContent =
              "parking availability: " + data.description;
          }
        } catch (error) {
          console.error('Error fetching parking data:', error);
        }
      }

      // Poll the server every 5 seconds to update the page with the latest image and description
      setInterval(fetchParkingData, 5000);

      // Initial call to load the data on page load
      fetchParkingData();
    </script>
  </body>
</html>
